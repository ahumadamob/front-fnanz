<div class="app-layout">
  <aside
    class="app-sidebar"
    [class.sidebar-narrow]="sidebarCollapsed()"
    [class.sidebar-hidden]="!sidebarVisible() && !isMobile()"
    [class.sidebar-mobile-visible]="isMobile() && sidebarVisible()"
    role="navigation"
    aria-label="Navegación principal"
  >
    <div class="app-sidebar__brand">
      <div class="app-logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 19v-6m5 6V5m5 14v-9m5 9V9" />
          <path d="M3 21h18" />
        </svg>
      </div>
      <div class="app-brand-text">
        <h1>Fnanz Plataforma</h1>
        <span class="env-pill">{{ envLabel() }}</span>
      </div>
    </div>
    <nav class="app-sidebar__nav" (click)="closeSidebarOnMobile()">
      <a routerLink="/" routerLinkActive="active-link" [routerLinkActiveOptions]="{ exact: true }">
        <span class="nav-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 11l9-8 9 8" />
            <path d="M5 13v7h4v-4h6v4h4v-7" />
          </svg>
        </span>
        <span>Dashboard</span>
      </a>
      <a routerLink="/categorias" routerLinkActive="active-link">
        <span class="nav-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h6v6H4zM14 4h6v6h-6zM4 14h6v6H4zM14 14h6v6h-6z" />
          </svg>
        </span>
        <span>Categorias</span>
      </a>
      <a routerLink="/periodos" routerLinkActive="active-link">
        <span class="nav-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
            <line x1="16" y1="2" x2="16" y2="6" />
            <line x1="8" y1="2" x2="8" y2="6" />
            <line x1="3" y1="10" x2="21" y2="10" />
          </svg>
        </span>
        <span>Periodos</span>
      </a>
      <a routerLink="/presupuestos" routerLinkActive="active-link">
        <span class="nav-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 1v4" />
            <path d="M7 5h10l4 6-4 6H7L3 11z" />
            <path d="M12 9v4" />
            <path d="M10 13h4" />
          </svg>
        </span>
        <span>Presupuestos</span>
      </a>
    </nav>
  </aside>

  <div
    class="app-sidebar__backdrop"
    *ngIf="isMobile() && sidebarVisible()"
    (click)="closeSidebarOnMobile()"
    aria-hidden="true"
  ></div>

  <div class="app-main">
    <header class="app-header">
      <div class="app-header__content container container--fluid">
        <div class="app-header__start">
          <div class="sidebar-toggle-group">
            <button
              type="button"
              class="icon-button header-icon-button app-btn app-btn--light"
              (click)="toggleSidebarVisible()"
              [fnTooltip]="sidebarVisible() ? 'Ocultar menú' : 'Mostrar menú'"
              aria-label="Alternar visibilidad del menú lateral"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <line x1="4" y1="6" x2="20" y2="6" />
                <line x1="4" y1="12" x2="20" y2="12" />
                <line x1="4" y1="18" x2="14" y2="18" />
              </svg>
            </button>
            <button
              type="button"
              class="icon-button header-icon-button app-btn app-btn--light"
              (click)="toggleSidebarCollapsed()"
              [fnTooltip]="sidebarCollapsed() ? 'Expandir menú' : 'Colapsar menú'"
              aria-label="Alternar colapso del menú lateral"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <polyline points="15 18 9 12 15 6" />
                <polyline points="9 18 15 12 9 6" />
              </svg>
            </button>
          </div>
          <h2>Panel administrativo</h2>
        </div>
        <nav class="app-navbar">
          <div class="app-header__actions">
            <span class="env-pill" aria-live="polite">{{ envLabel() }}</span>
            <div
              class="app-dropdown"
              #quickActionsDropdown
              [class.app-dropdown--open]="quickActionsOpen()"
              (keydown.escape)="closeQuickActions()"
              (focusout)="onDropdownFocusOut($event)"
            >
              <button
                class="app-dropdown__toggle app-btn app-btn--primary"
                type="button"
                (click)="toggleQuickActions()"
                [attr.aria-expanded]="quickActionsOpen()"
                aria-haspopup="true"
              >
                Acciones rápidas
                <span class="dropdown-indicator" aria-hidden="true">▾</span>
              </button>
              <ul
                class="app-dropdown__menu"
                *ngIf="quickActionsOpen()"
                role="menu"
              >
                <li>
                  <a class="app-dropdown__item" routerLink="/" role="menuitem" (click)="onQuickActionSelected()">Ir al dashboard</a>
                </li>
                <li>
                  <a class="app-dropdown__item" routerLink="/categorias" role="menuitem" (click)="onQuickActionSelected()">Gestionar categorías</a>
                </li>
                <li>
                  <a class="app-dropdown__item" routerLink="/periodos" role="menuitem" (click)="onQuickActionSelected()">Ver períodos</a>
                </li>
                <li>
                  <a class="app-dropdown__item" routerLink="/presupuestos" role="menuitem" (click)="onQuickActionSelected()">Ir a presupuestos</a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <main class="app-main__content">
      <div class="container container--fluid">
        <router-outlet />
      </div>
    </main>
    <footer class="app-footer">
      <div class="container">
        <p>&copy; {{ currentYear }} Fnanz. Construido con Angular standalone y servicios.</p>
      </div>
    </footer>
  </div>
</div>
