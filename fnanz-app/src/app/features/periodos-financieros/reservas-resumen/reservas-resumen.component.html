<section class="feature feature--summary">
  <header class="feature__hero">
    <div class="feature__intro">
      <p class="feature__eyebrow">Análisis</p>
      <h2 class="feature__title">Resumen de partidas por categoría</h2>
      <p class="feature__description">
        Periodo:
        <span *ngIf="periodoNombre(); else periodoFallback">{{ periodoNombre() }}</span>
        <ng-template #periodoFallback>
          {{ periodoId() ? ('#' + periodoId()) : 'Desconocido' }}
        </ng-template>
      </p>
    </div>
    <button type="button" class="btn btn--ghost feature__cta" routerLink="/periodos">
      Volver a periodos
    </button>
  </header>

  <div class="card feature__panel">
    <p *ngIf="loading()" class="feature__banner feature__banner--info">Cargando resumen...</p>
    <p *ngIf="error() && !loading()" class="feature__banner feature__banner--error">{{ error() }}</p>

    <ng-container *ngIf="!loading() && resumen() as resumenData">
      <ng-container *ngIf="resumenData; else emptyState">
        <section class="summary__grid">
          <article class="card summary-card">
            <header class="summary-card__header">
              <h3>Ingresos</h3>
              <span class="tipo-pill tipo-pill--ingreso summary__pill">
                Reservado: {{ resumenData.totalIngresos.montoReservado | currency: 'USD':'symbol-narrow':'1.0-0' }}
              </span>
            </header>

            <p *ngIf="resumenData.ingresos.length === 0" class="summary-card__empty">
              No hay partidas de ingreso para este periodo.
            </p>

            <table *ngIf="resumenData.ingresos.length > 0" class="data-table summary-table">
              <thead>
                <tr>
                  <th>Categoría</th>
                  <th>Reservado</th>
                  <th>Aplicado</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let ingreso of resumenData.ingresos; trackBy: trackByCategoriaId">
                  <td>
                    <div class="summary__category-name">{{ ingreso.categoriaNombre }}</div>
                    <small *ngIf="ingreso.orden != null" class="summary__category-order">Orden {{ ingreso.orden }}</small>
                  </td>
                  <td>{{ ingreso.montoReservado | currency: 'USD':'symbol-narrow':'1.0-0' }}</td>
                  <td>{{ ingreso.montoAplicado | currency: 'USD':'symbol-narrow':'1.0-0' }}</td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td>Total</td>
                  <td>{{ resumenData.totalIngresos.montoReservado | currency: 'USD':'symbol-narrow':'1.0-0' }}</td>
                  <td>{{ resumenData.totalIngresos.montoAplicado | currency: 'USD':'symbol-narrow':'1.0-0' }}</td>
                </tr>
              </tfoot>
            </table>
          </article>

          <article class="card summary-card">
            <header class="summary-card__header">
              <h3>Egresos</h3>
              <span class="tipo-pill tipo-pill--egreso summary__pill">
                Reservado: {{ resumenData.totalEgresos.montoReservado | currency: 'USD':'symbol-narrow':'1.0-0' }}
              </span>
            </header>

            <p *ngIf="resumenData.egresos.length === 0" class="summary-card__empty">
              No hay partidas de egreso para este periodo.
            </p>

            <table *ngIf="resumenData.egresos.length > 0" class="data-table summary-table">
              <thead>
                <tr>
                  <th>Categoría</th>
                  <th>Reservado</th>
                  <th>Aplicado</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let egreso of resumenData.egresos; trackBy: trackByCategoriaId">
                  <td>
                    <div class="summary__category-name">{{ egreso.categoriaNombre }}</div>
                    <small *ngIf="egreso.orden != null" class="summary__category-order">Orden {{ egreso.orden }}</small>
                  </td>
                  <td>{{ egreso.montoReservado | currency: 'USD':'symbol-narrow':'1.0-0' }}</td>
                  <td>{{ egreso.montoAplicado | currency: 'USD':'symbol-narrow':'1.0-0' }}</td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td>Total</td>
                  <td>{{ resumenData.totalEgresos.montoReservado | currency: 'USD':'symbol-narrow':'1.0-0' }}</td>
                  <td>{{ resumenData.totalEgresos.montoAplicado | currency: 'USD':'symbol-narrow':'1.0-0' }}</td>
                </tr>
              </tfoot>
            </table>
          </article>
        </section>

        <section class="card summary__totals">
          <h3>Total general</h3>
          <div class="summary__totals-grid">
            <div class="summary-total">
              <span class="summary-total__label">Monto reservado</span>
              <strong>{{ resumenData.totalGeneral.montoReservado | currency: 'USD':'symbol-narrow':'1.0-0' }}</strong>
            </div>
            <div class="summary-total">
              <span class="summary-total__label">Monto aplicado</span>
              <strong>{{ resumenData.totalGeneral.montoAplicado | currency: 'USD':'symbol-narrow':'1.0-0' }}</strong>
            </div>
          </div>
        </section>
      </ng-container>
    </ng-container>

    <ng-template #emptyState>
      <p class="summary__empty">No hay información de partidas presupuestarias para este periodo.</p>
    </ng-template>
  </div>
</section>
